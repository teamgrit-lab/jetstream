!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("StreamMixer",[],e):"object"==typeof exports?exports.StreamMixer=e():t.StreamMixer=e()}(this,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){console.log("%cStreamMixer 1.7.56","font-weight: 700;"),t.exports=i(1).default},function(t,e,i){"use strict";i.r(e);var s=function(){let t=null,e={videoMixer:null,videoElementList:0,droppedFrames:0};function i(){console.log(`%c[START TIME]%c : ${t}`,"font-weight: 700; color: white; background: orange;","font-weight: 400; background: none"),console.log(`%c[CURRENT TIME]%c : ${performance.now()}`,"font-weight: 700; color: white; background: orange;","font-weight: 400; background: none")}function s(t,e){console.log(`%c[DEBUG]%c(${t}) : ${e}`,"font-weight: 700; color: white; background: green;","font-weight: 400; background: none")}return{init:function(i,s){t=performance.now(),e.videoMixer=s,e.videoElementList=i},showObjectList:function(){s("ObjectList",e.videoElementList)},Frames:function(){let t=0,o=0;return{setLastExecuteTime:function(e){t=e},setLastFrameDelay:function(t){o=t},lastDrawTime:function(){i(),s("LastExecuteTime",t),s("LastFrameDelay",o),s("Total",t+o)},lastDrawTimeVideoObjects:function(){i(),s("ObjectsLastExecuteTime",e.videoMixer.showObjectDrawTimes())}}}(),DroppedFrames:function(){return{increase:function(){e.droppedFrames=e.droppedFrames+1},show:function(){i(),s("DroppedFrames",e.droppedFrames);const o=(performance.now()-t)/1e3;s("DroppedFrames/s",e.droppedFrames/o)}}}()}}();class o{constructor({id:t,source:e=null,sourceType:i="stream",context:s,destination:o,mediaType:n,muted:h}){if(this._id=t,this._source=e,this._sourceType=i,this._audioCtx=s,this._destination=o,this._mediaType=n,this._muted=h,"stream"===this._sourceType?this._sourceNode=this._audioCtx.createMediaStreamSource(this._source):this._sourceNode=this._audioCtx.createMediaElementSource(this._source),this._gainNode=this._audioCtx.createGain(),"mycam"===n){this._gainNode.gain.value=.5;const t=this._audioCtx.createBiquadFilter();var r=Math.sqrt(102e4);t.frequency.value=r,t.Q.value=r/-3100,this._sourceNode.connect(t),t.connect(this._gainNode)}else this._gainNode.gain.value=1,this._sourceNode.connect(this._gainNode);this._gainNode.connect(this._destination)}get id(){return this._id}disconnect(){this._gainNode.disconnect(),this._sourceNode.disconnect()}mute(t){t?this._gainNode.gain.setValueAtTime(0,this._audioCtx.currentTime):this._gainNode.gain.setValueAtTime(1,this._audioCtx.currentTime)}setVolume(t){this._gainNode.gain.setValueAtTime(t,this._audioCtx.currentTime)}}class n{constructor(){const t=window.AudioContext||window.webkitAudioContext;this.audioCtx=new t,this.destination=this.audioCtx.createMediaStreamDestination(),this._isEnable=!0,this.audioObjectList=[],this.addNoiseOscillator()}addNoiseOscillator(){const t=this.audioCtx.createOscillator();t.type="sine",t.frequency.setValueAtTime(24e3,this.audioCtx.currentTime),t.connect(this.destination),t.start()}getContext(){return this.audioCtx}getDestination(){return this.destination}getMasterNode(){return this.masterNode}addAudioObject(t){this.audioObjectList.push(t)}removeAudioObject(t){const e=this.audioObjectList.findIndex(e=>e.id===t);-1!==e&&(this.audioObjectList[e].disconnect(),this.audioObjectList.splice(e,1))}getAudioTracks(){return this.destination.stream.getTracks()}mute(t,e){const i=this.audioObjectList.findIndex(e=>e.id===t);this.audioObjectList[i].mute(e)}setVolume(t,e){const i=this.audioObjectList.findIndex(e=>e.id===t);this.audioObjectList[i].setVolume(e)}}var h=function(){var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("msie")?"msie":-1!=t.indexOf("chrome")?"chrome":-1!=t.indexOf("safari")?"safari":-1!=t.indexOf("firefox")?"firefox":"other"};let r={width:1280,height:720};const c=60,a=1e3/60*(60/c)-1e3/60*.5,d=1e3/c;let l=0;const u={MIN_WIDTH:370,MIN_HEIGHT:208},_={POINT_SIZE:40,LINE_WIDTH:4,LINE_COLOR:"rgba(0,184,152,1)",Z_INDEX_BUTTON_WIDTH:80,Z_INDEX_BUTTON_HEIGHT:60,Z_INDEX_BUTTON_COLOR:"rgba(0,184,152,.75)",Z_INDEX_BUTTON_COLOR_UP:"rgba(0,184,152,.85)",Z_INDEX_BUTTON_COLOR_DOWN:"rgba(0,184,152,.5)",Z_INDEX_TEXT_FONT:"48px Arial",Z_INDEX_TEXT_FONT_SIZE:48,Z_INDEX_TEXT_WIDTH:80,Z_INDEX_TEXT_HEIGHT:80,ARROW_WIDTH:28,ARROW_HEIGHT:28,ARROW_COLOR:"#222222"},O={NONE:-1,CLICKED:0},f={Z_INDEX_MIN:1,Z_INDEX_MAX:9};class T{constructor({elementID:t,width:e,height:i}){this.videoObjectList=[],this.videoObjectListAsc=[],this.mouseButtonState=O.NONE,r.width=e,r.height=i,this.initCanvas(t),this.vRatio=r.width/this.uiCanvas.offsetWidth,this.hRatio=r.height/this.uiCanvas.offsetHeight,this.delta=0,this.now=0,this.then=Date.now(),this.bindEventHandler(),console.log("VideoMixer Init"),console.log("Browser : ",h()),console.log(`RESOLUTION : ${r.width} x ${r.height}`),console.log(`FPS : ${c}`)}initCanvas(t){this.uiCanvas=document.getElementById(t),this.uiCanvasCtx=this.uiCanvas.getContext("2d",{desynchronized:!0,alpha:!1}),this.uiCanvas.width=r.width,this.uiCanvas.height=r.height,this.frontCanvas=document.createElement("canvas"),this.frontCanvas.width=r.width,this.frontCanvas.height=r.height,this.frontCanvasCtx=this.frontCanvas.getContext("2d",{desynchronized:!0,alpha:!1}),"chrome"===h()||"safari"===h()?this.mixedStream=this.frontCanvas.captureStream(0):this.mixedStream=this.frontCanvas.captureStream()}setResolution({width:t,height:e}){const i=r.width/t,s=r.height/e;r.width=t,r.height=e,this.uiCanvas.width=r.width,this.uiCanvas.height=r.height,this.frontCanvas.width=r.width,this.frontCanvas.height=r.height,this.vRatio=r.width/this.uiCanvas.offsetWidth,this.hRatio=r.height/this.uiCanvas.offsetHeight,this.videoObjectList.forEach(t=>{t.setPosition({top:t.top/s,left:t.left/i,width:t.width/i,height:t.height/s}),console.log(t)})}setVisible(t,e){const i=this.videoObjectList.findIndex(e=>e.id===t);this.videoObjectList[i].setVisible(e)}getVideoObject(t){const e=this.videoObjectList.findIndex(e=>e.id===t);return this.videoObjectList[e]}addVideoObject(t){this.videoObjectList.push(t),this.sortVideoObjectList()}removeVideoObject(t){const e=this.videoObjectList.findIndex(e=>e.id===t);this.videoObjectList.splice(e,1);const i=this.videoObjectListAsc.findIndex(e=>e.id===t);this.videoObjectListAsc.splice(i,1),this.detachEventObject()}drawCalcDeltaTime(){window.requestAnimationFrame(this.drawCalcDeltaTime.bind(this)),this.now=Date.now(),this.delta=this.now-this.then,this.delta>d&&(this.then=this.now-this.delta%d,this.frontCanvasCtx.clearRect(0,0,r.width,r.height),this.frontCanvasCtx.fillStyle="black",this.frontCanvasCtx.fillRect(0,0,r.width,r.height),this.videoObjectList.forEach(t=>{const e=t.getDrawSource();if(!e)return;const{src:i,videoWidth:s,videoHeight:o}=e;this.frontCanvasCtx.drawImage(i,0,0,s,o,t.left,t.top,t.width,t.height)}),this.pointPositions&&this.drawPoints(),this.uiCanvasCtx.drawImage(this.frontCanvas,0,0),this.mouseOverObject&&(this.mouseOverObject.isFullscreen()||(this.drawOutline(),this.drawTriangle()),this.drawZIndexButton()),this.mixedStream.getVideoTracks()[0].requestFrame&&this.mixedStream.getVideoTracks()[0].requestFrame())}drawOutline(){const t=this.mouseOverObject,e=this.uiCanvasCtx;e.strokeStyle=_.LINE_COLOR,e.lineWidth=_.LINE_WIDTH,e.strokeRect(t.left+parseInt(_.LINE_WIDTH/2),t.top+parseInt(_.LINE_WIDTH/2),t.width-parseInt(_.LINE_WIDTH+1),t.height-parseInt(_.LINE_WIDTH+1))}drawTriangle(){const t=this.mouseOverObject,e=this.uiCanvasCtx;(()=>{e.beginPath();let i=t.left,s=t.top;e.moveTo(i,s),i=t.left+_.POINT_SIZE,s=t.top,e.lineTo(i,s),i=t.left,s=t.top+_.POINT_SIZE,e.lineTo(i,s),e.closePath(),e.fillStyle=_.LINE_COLOR,e.fill()})(),(()=>{e.beginPath();let i=t.left+t.width,s=t.top+t.height-_.POINT_SIZE;e.moveTo(i,s),i=t.left+t.width,s=t.top+t.height,e.lineTo(i,s),i=t.left+t.width-_.POINT_SIZE,s=t.top+t.height,e.lineTo(i,s),e.closePath(),e.fillStyle=_.LINE_COLOR,e.fill()})()}drawZIndexButton(){const t=this.mouseOverObject,e=this.uiCanvasCtx;let i=t.top+_.LINE_WIDTH,s=t.left+t.width-_.LINE_WIDTH;t.isFullscreen()&&(s=r.width);(()=>{const t=t=>{e.fillStyle=t,e.fillRect(s-_.Z_INDEX_BUTTON_WIDTH,i,_.Z_INDEX_BUTTON_WIDTH,_.Z_INDEX_BUTTON_HEIGHT)},o=t=>{e.fillStyle=t,e.fillRect(s-_.Z_INDEX_BUTTON_WIDTH,i+_.Z_INDEX_BUTTON_HEIGHT,_.Z_INDEX_BUTTON_WIDTH,_.Z_INDEX_BUTTON_HEIGHT)};switch(this.clickPosition){case"up-arrow":this.mouseButtonState===O.NONE?t(_.Z_INDEX_BUTTON_COLOR_UP):this.mouseButtonState===O.CLICKED&&t(_.Z_INDEX_BUTTON_COLOR_DOWN),o(_.Z_INDEX_BUTTON_COLOR);break;case"down-arrow":this.mouseButtonState===O.NONE?o(_.Z_INDEX_BUTTON_COLOR_UP):this.mouseButtonState===O.CLICKED&&o(_.Z_INDEX_BUTTON_COLOR_DOWN),t(_.Z_INDEX_BUTTON_COLOR);break;default:t(_.Z_INDEX_BUTTON_COLOR),o(_.Z_INDEX_BUTTON_COLOR)}})(),(()=>{e.beginPath();let t=s-_.Z_INDEX_BUTTON_WIDTH/2,o=i+(_.Z_INDEX_BUTTON_HEIGHT-_.ARROW_HEIGHT)/2;e.moveTo(t,o),t+=_.ARROW_WIDTH/2,o+=_.ARROW_HEIGHT,e.lineTo(t,o),t-=_.ARROW_WIDTH,e.lineTo(t,o),e.closePath(),e.fillStyle=_.ARROW_COLOR,e.fill()})(),(()=>{e.beginPath();let t=s-_.Z_INDEX_BUTTON_WIDTH/2,o=i+_.Z_INDEX_BUTTON_HEIGHT+(_.Z_INDEX_BUTTON_HEIGHT/2+_.ARROW_HEIGHT/2);e.moveTo(t,o),t+=_.ARROW_WIDTH/2,o-=_.ARROW_HEIGHT,e.lineTo(t,o),t-=_.ARROW_WIDTH,e.lineTo(t,o),e.closePath(),e.fillStyle=_.ARROW_COLOR,e.fill()})()}setPointPositions(t){this.pointPositions=t}drawPoints(){const t=this.frontCanvasCtx;this.pointPositions.forEach(e=>{const{x:i,y:s}=e;t.beginPath(),t.arc(i,s,5,0,2*Math.PI),t.fillStyle="aqua",t.fill()})}clearPoints(){this.pointPositions=null}captureFrame(t){t-l<a?window.requestAnimationFrame(this.captureFrame.bind(this)):(l=t,this.frontCanvasCtx.drawImage(this.canvas,0,0),this.mixedStream.getVideoTracks()[0].requestFrame(),window.requestAnimationFrame(this.captureFrame.bind(this)))}getVideoTracks(){return this.mixedStream.getVideoTracks()}sortVideoObjectList(){this.videoObjectList.sort(function(t,e){return t.zIndex<e.zIndex?-1:t.zIndex>e.zIndex?1:t.createdAt<e.createdAt?-1:t.createdAt>e.createdAt?1:0}),this.videoObjectListAsc=[];for(let t=this.videoObjectList.length-1;t>=0;t--)this.videoObjectListAsc.push(this.videoObjectList[t])}bindEventHandler(){this.uiCanvas.ondblclick=t=>{const{clickObj:e,clickPosition:i}=this.findClickObject(t);if(e&&"move"===i){if(e.isFullscreen()){if(e.hasSavedPosition())e.restorePosition();else{e.savePosition();let t=u.MIN_WIDTH,i=u.MIN_HEIGHT;if(e.width>e.height){const s=e.height/e.width;i=(t=u.MIN_WIDTH)*s}else{const s=e.width/e.height;t=(i=u.MIN_HEIGHT)*s}e.setPosition({top:10,left:10,width:t,height:i,zIndex:e.zIndex,fullScreen:!1})}this.mouseOverObject=e}else{e.savePosition();let t=e.width/e.height;if(t>0){const i=r.width,s=r.width/t;s>r.height?e.setPosition({top:0,left:0,width:r.height*t,height:r.height,fullScreen:!0}):e.setPosition({top:0,left:0,width:i,height:s,fullScreen:!0})}else{const i=r.height,s=r.height*t;e.setPosition({top:0,left:0,width:s,height:i,fullScreen:!0})}this.mouseOverObject=null}this.sortVideoObjectList()}},this.uiCanvas.onmousedown=t=>{const{clickObj:e,clickPosition:i}=this.findClickObject(t);if(this.mouseButtonState=t.button,e){if(e.isFullscreen())return;this.clickObject=e,this.clickPosition=i,this.startPos={x:t.offsetX,y:t.offsetY},this.startObjectPos={top:e.top,left:e.left,bottom:r.height-(e.top+e.height),right:r.width-(e.left+e.width),width:e.width,height:e.height,ratio:e.height/e.width}}else this.detachEventObject()},this.uiCanvas.onmouseover=t=>{const{clickObj:e,clickPosition:i}=this.findClickObject(t);this.mouseOverObject=e,this.clickPosition=i},this.uiCanvas.onmouseout=t=>{this.detachEventObject()},this.uiCanvas.onmousemove=t=>{switch(this.mouseButtonState){case O.NONE:this.mouseOverObject&&this.detectMouseOut(t);const{clickObj:e,clickPosition:i}=this.findClickObject(t);if(e)switch(this.mouseOverObject=e,this.clickPosition=i,i){case"up-arrow":case"down-arrow":this.uiCanvas.style.cursor="pointer";break;case"move":e.isFullscreen()||(this.uiCanvas.style.cursor="move");break;case"top-left":case"bottom-right":e.isFullscreen()||(this.uiCanvas.style.cursor="nwse-resize")}break;case O.CLICKED:if(this.clickObject){const e=t.offsetX-this.startPos.x,i=t.offsetY-this.startPos.y;let s=this.calcUItoCanvasX(e),o=this.calcUItoCanvasY(i),n=this.startObjectPos.width,h=n*this.startObjectPos.ratio;switch(this.clickPosition){case"top-left":if(s*=-1,h=(n=this.startObjectPos.width+s)*this.startObjectPos.ratio,n<u.MIN_WIDTH)return;if(h<u.MIN_HEIGHT)return;this.clickObject.setPosition({bottom:this.startObjectPos.bottom,right:this.startObjectPos.right,width:n,height:h});break;case"bottom-right":if(h=(n=this.startObjectPos.width+s)*this.startObjectPos.ratio,n<u.MIN_WIDTH)return;if(h<u.MIN_HEIGHT)return;this.clickObject.setPosition({top:this.startObjectPos.top,left:this.startObjectPos.left,width:n,height:h});break;case"move":if(this.clickObject.isFullscreen())return;this.clickObject.left=this.startObjectPos.left+s,this.clickObject.top=this.startObjectPos.top+o}}}},this.uiCanvas.onmouseup=t=>{this.mouseButtonState=O.NONE},this.uiCanvas.onclick=t=>{const{clickObj:e,clickPosition:i}=this.findClickObject(t);"up-arrow"===i?e.zIndex<f.Z_INDEX_MAX&&(e.zIndex=e.zIndex+1,this.sortVideoObjectList()):"down-arrow"===i&&e.zIndex>f.Z_INDEX_MIN&&(e.zIndex=e.zIndex-1,this.sortVideoObjectList())}}calcUItoCanvasX(t){return parseInt(t*this.vRatio)}calcUItoCanvasY(t){return parseInt(t*this.hRatio)}findClickObject(t){let e=this.videoObjectListAsc;const i=this.calcUItoCanvasX(t.offsetX),s=this.calcUItoCanvasY(t.offsetY);let o="move";return{clickObj:e.find(t=>{let e=t.top,n=t.left,h=t.top+t.height,c=t.left+t.width;return t.isFullscreen()&&(e=0,n=0,h=r.height,c=r.width),s>=e&&s<=e+_.POINT_SIZE&&i>=n&&i<=n+_.POINT_SIZE?(o="top-left",t):s>=h-_.POINT_SIZE&&s<=h&&i>=c-_.POINT_SIZE&&i<=c?(o="bottom-right",t):s>=e&&s<=e+_.Z_INDEX_BUTTON_HEIGHT&&i>=c-_.Z_INDEX_BUTTON_WIDTH&&i<=c?(o="up-arrow",t):s>=e+_.Z_INDEX_BUTTON_HEIGHT&&s<=e+2*_.Z_INDEX_BUTTON_HEIGHT&&i>=c-_.Z_INDEX_BUTTON_WIDTH&&i<=c?(o="down-arrow",t):s>=e&&s<=h&&i>=n&&i<=c?(o="move",t):void 0}),clickPosition:o}}detachEventObject(){this.uiCanvas.style.cursor=null,this.mouseOverObject=null,this.clickObject=null,this.clickPosition=null,this.startPos=null,this.startObjectPos=null,this.mouseButtonState=O.NONE}detectMouseOut(t){if(!this.mouseOverObject)return;const e=parseInt(t.offsetX*this.vRatio),i=parseInt(t.offsetY*this.hRatio);(e<this.mouseOverObject.left||e>this.mouseOverObject.right||e>this.mouseOverObject.left+this.mouseOverObject.width||i<this.mouseOverObject.top||i>this.mouseOverObject.bottom||i>this.mouseOverObject.top+this.mouseOverObject.height)&&(this.uiCanvas.style.cursor=null,this.mouseOverObject=null)}showObjectDrawTimes(){return this.videoObjectList.map(t=>t.lastDrawExecuteTime.toString())}}let m={width:1280,height:720};const g={TOP:10,LEFT:10,RIGHT:10,BOTTOM:10},I={SMALL:{WIDTH:m.width/4,HEIGHT:m.height/4}};m.width,m.height,m.width,m.height,m.width,m.width,m.height,g.TOP,g.LEFT,g.TOP,b(I.SMALL.WIDTH),g.TOP,v(I.SMALL.WIDTH),w(I.SMALL.HEIGHT),g.LEFT,w(I.SMALL.HEIGHT),b(I.SMALL.WIDTH),w(I.SMALL.HEIGHT),v(I.SMALL.HEIGHT);function b(t){return m.width-t-g.RIGHT}function v(t){return m.width/2-t/2}function w(t){return m.height-t-g.BOTTOM}class p{constructor(t){const{id:e,top:i,left:s,bottom:o,right:n,width:h=0,height:r=0,zIndex:c=0,fullScreen:a=!1,autoSize:d=!1,transparent:l=!1,onended:u=null,visible:_=!0,source:O,sourceType:f="stream"}=t;if(this._id=e,this._transparent=l,this._visible=_,this._source=O,this._sourceType=f,this._top=i,this._left=s,this._bottom=o,this._right=n,this._width=h,this._height=r,this._zIndex=c,this._fullScreen=a,this._createdAt=performance.now(),d){const t=h/this._source.videoWidth;this._height=this._source.videoHeight*t}this.setPosition({top:this._top,left:this._left,bottom:this._bottom,right:this._right,width:this._width,height:this._height})}get id(){return this._id}setVisible(t){this._visible=t}getVisible(){return this._visible}getDrawSource(){if(!this._visible)return;const t=Math.max(this._source.videoWidth||0,this._source.width||0),e=Math.max(this._source.videoHeight||0,this._source.height||0);return 0!==t&&0!==e?{src:this._source,videoWidth:t,videoHeight:e}:void 0}isFullscreen(){return this._fullScreen}hasSavedPosition(){return this._savedPosition}savePosition(){this._oldTop=this._top,this._oldLeft=this._left,this._oldBottom=this._bottom,this._oldRight=this._right,this._oldWidth=this._width,this._oldHeight=this._height,this._oldZIndex=this._zIndex,this._oldFullScreen=this._fullScreen,this._savedPosition=!0}restorePosition(){this.setPosition({top:this._oldTop,left:this._oldLeft,bottom:this._oldBottom,right:this.oldRight,width:this._oldWidth,height:this._oldHeight,zIndex:this._oldZIndex,fullScreen:this._oldFullScreen})}setPosition(t){const{top:e,left:i,bottom:s,right:o,width:n=this._width,height:h=this._height,zIndex:r=this.zIndex,fullScreen:c=this._fullScreen}=t;this._top=s?void 0:e,this._left=o?void 0:i,this._bottom=e?void 0:s,this._right=i?void 0:o,this._width=n||this._width,this._height=h||this._height,this._zIndex=r||this._zIndex,this._fullScreen=c||this._fullScreen,s&&!e&&(this._top=m.height-s-h,this._bottom=void 0),o&&!i&&(this._left=m.width-o-n,this._right=void 0)}get top(){return this._top}set top(t){this._top=t}get left(){return this._left}set left(t){this._left=t}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t}set outLine(t){this._outline=t}get createdAt(){return this._createdAt}get lastDrawExecuteTime(){return this._drawExecuteTime}}var E=(()=>{let t=[],e=null,i=null,h=null,r=!1;const c=async function(){const t=new MediaStream;e.getVideoTracks().forEach(function(e){t.addTrack(e)}),i.getAudioTracks().forEach(function(e){t.addTrack(e)}),h=t},a=e=>{const i=t.findIndex(t=>t.id===e);return t[i]};return{init:async o=>{(e=new T(o)).drawCalcDeltaTime(),i=new n,await c(),s.init(t,e),r=!0},initSuccess:()=>r,getIDs:()=>{return t.map(t=>t.id)},getVideoElement:t=>a(t).videoEl,addMedia:(s={source:source,sourceType:"stream",video:{},audio:{},onended:onended})=>new Promise(async(n,h)=>{const{source:r,sourceType:c}=s,a=(()=>"_"+Math.random().toString(36).substr(2,9))(),d=document.createElement("video");"url"===c?(d.muted=!1,d.autoplay=!0,d.src=r,d.load(),s.video.startTime&&(d.currentTime=s.video.startTime),d.crossOrigin="anonymous"):("mycam"===s.audio.mediaType&&(d.muted=!0),d.srcObject=r,s.video.startTime&&(d.currentTime=s.video.startTime)),d.play().then(()=>{"url"===c&&(d.crossOrigin="anonymous"),s.onended&&(d.onended=()=>{s.onended(a)}),t.push({id:a,videoEl:d,stream:"stream"===c?r:null});const h=new p({id:a,stream:r,source:d,sourceType:c,...s.video});if(e.addVideoObject(h),"url"===c){const t=new o({id:a,source:d,sourceType:c,context:i.getContext(),destination:i.getDestination(),...s.audio});i.addAudioObject(t)}else if(r.getAudioTracks&&0!==r.getAudioTracks().length){const t=new o({id:a,source:r,sourceType:c,context:i.getContext(),destination:i.getDestination(),...s.audio});i.addAudioObject(t)}n({objID:a})}).catch(t=>{console.log(t.toString()),h({err:"not play video"})})}),removeMedia:s=>{const o=t.findIndex(t=>t.id===s);-1!==o&&t[o]?(e.removeVideoObject(s),i.removeAudioObject(s),t[o].videoEl&&(t[o].videoEl=void 0),t.splice(o,1)):console.log(`[StreamMixer] %cNot Found MediaObject : ${s}`,"background: red; color: #fff")},changeStream:(t,e)=>new Promise((i,s)=>{let o=a(t);return o||s("not found mediaObject"),o.videoEl.srcObject=e,o.videoEl.play(),i()}),getStream:()=>h,setResolution:function(t){e.setResolution(t)},pause:function(t){a(t).videoEl.pause()},play:function(t){a(t).videoEl.play()},mute:function(t,e){i.mute(t,e)},setVolume:function(t,e){i.setVolume(t,e)},getCurrentTime:function(e){const i=t.findIndex(t=>t.id===e),s=t[i];return s?s.videoEl.currentTime:0},setCurrentTime:function(e,i){const s=t.findIndex(t=>t.id===e),o=t[s];o&&(o.videoEl.currentTime=i)},setVisible:function(t,i){e.setVisible(t,i)},setPosition:function(t){const i=e.getVideoObject(t.id);i&&(i.setPosition(t),e.sortVideoObjectList())},drawPoints:function(t){e.setPointPositions(t)},clearPoints:function(){e.clearPoints()},Debug:{...s}}})();e.default=E}])});
//# sourceMappingURL=stream-mixer.min.map